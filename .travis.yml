language: ruby
rvm: 2.7
cache:
  - bundler
  - yarn

services: postgresql

before_install:
  - sudo npm cache clean -f
  - sudo npm install -g n
  - sudo n stable

before_script:
  - node -v && yarn -v
  - RAILS_ENV=test bundle exec rails webpacker:compile
  - psql -c 'create database instavideo_test;' -U postgres

script:
  - bundle exec rubocop
  - bundle exec brakeman -6 -q
  - bundle exec rspec
  - git fetch origin master:master
  - bundle exec undercover -c master
